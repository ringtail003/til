---
title: CSSの詳細度
description: null
tags: css
updatedAt: 2022-11-29
published: true
---

https://developer.mozilla.org/ja/docs/Web/CSS/Specificity

詳細度 = 重み計算のアルゴリズム。
重みは分類別のセレクターによって決定される。

## 分類別セレクター

セレクター | 重み | 記述
--- | --- | ---
ID列 | 1-0-0 | `#id`
クラス列（クラス） | 0-1-0 | `.myClass`
クラス列（属性） | 0-1-0 | `[type="radio"]`
クラス列（擬似クラス） | 0-1-0 | `:hover`
要素型列（要素） | 0-0-1 | `p` `h1`
要素型列（疑似要素） | 0-0-1 | `::before` `::placeholder`
値なし | 0-0-0 | `*` `:where()`

- 結合子（+>~||）は重みに値を追加しない。
- `:not()` `:is()` は重みがない。

## 重みの計算

```css
[type="password"],
input:focus,
:root #myApp input:required {
  ...
}
```

```html
<div id="myApp">
  <input type="password" required>
</div>
```

- 0-1-0 `[type]`
- 1-0-0 `#myApp`
- 0-1-1 `input:required`

フォーカス有無にかかわらず、詳細度は 1-2-1 になる。
詳細度の重みのもっとも大きいものが採用されるため。

## 重みの優先順位

重みにより競合する CSS の勝ち負けが決まる。

```css
/* 1-0-0: WIN */
#myApp { }

/* 0-1-1 */
.myApp { }
```

同じ重みの ID 列が競合する場合は、次のクラス列が評価される。

```css
/* 1-0-0 */
#myApp { }

/* 1-1-0: WIN */
#myApp [id=foo] { }
```

重ねて記述するとそれだけ重みが増す。

```css
/* 0-1-1: WIN */
:root input {}

/* 0-0-4 */
html body main input {}
```

重みが 3 列すべて同じであれば最後に宣言されたスタイルが優先される。

```css
/* 0-1-1 */
input.myClass {}

/* 0-1-1: WIN */
:root input {}
```

:is や :not はそれ自体に重みを持たない。
セレクターのリストから重み付けされる。

```css
/* 1-0-1 */
p:not(#fakeId) {}

/* 1-0-0: カンマ区切りはより詳細度の高いほうが優先されるっぽい */
:is(p, #fakeId) {}
```

:is や :not を使うと詳細度を高くするための操作ができる。
この方法はハックなため、なぜそれが必要だったかコメントを書いたほうが良い。

```css
/* 3-0-1: 詳細度を高くするため ID 列を指定 */
a:not(#fakeId#fakeId#fakeId) {}
```

# インラインスタイル

インラインスタイル `style=""` はもっとも高い詳細度と考えることができる。
重みのフォーマットで表現するなら 1-0-0-0 のようなもの。
これを上書きする唯一の方法は !important の使用。

# !important

important でマークされた宣言はカスケードを逆転させオリジン内の宣言を上書きする。

1. ユーザーエージェントスタイルシート（ブラウザが適用する既定のスタイル） 
2. 作成者スタイルシート（ウェブ開発者によって書かれたスタイル）
3. ユーザースタイルシート（ブラウザでアクセスしたユーザーが拡張機能などを使って適用するスタイル）

これらはカスケードというアルゴリズムで組み合わされ、スタイルが決定する。
important を使うとより高いオリジンとして扱われる。作成者スタイルシートの important よりユーザーエージェントスタイルシートの important のほうが高いオリジンになり、カスケード順を逆転させることができる。

# :where

常に詳細度が 0-0-0 に置き換えられる。
サードパーティ CSS など作成する場合に詳細度を下げておくことは良い習慣と考えられている。

```css
/* サードパーティ: 0-0-1 */
:where(#foo) a {}
```

```css
/* サードパーティの利用者: 0-0-2 */
footer a {}
```

# 詳細度を下げる

```css
/* 1-0-1 */
#foo a {}
```

id を属性として記述することで詳細度を下げられる。

```css
/* 0-1-1 */
[id="foo"] a {}

/* 0-0-1 */
:where(#foo) a {}
```

# 詳細度を高める

```css
/* 1-0-1 */
#foo a {}
```

id を複製して詳細度を上げられる。
important と同じでコメントを書いておかないと意図が伝わらないことに注意。

```css
/* 3-0-1 */
#foo#foo#foo a {}
```
# important の回避

## 方法１

* 重要な宣言だけを含むスタイルシートを作成。
* layer() を使用して最初にインポートする。

```css
@import overrides.css layer();
```

## 方法2

* カスケードレイヤーを作成。
* レイヤーの中で上書きする。

```css
@layer overrides;

[id="element"] p {}

@layer overrides {
  [id="element"] p {}
}
```
